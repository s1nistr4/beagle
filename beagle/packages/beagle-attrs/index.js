"use strict";var _assert=_interopRequireDefault(require("assert")),_constantinople=_interopRequireDefault(require("constantinople")),_beagleRuntime=_interopRequireDefault(require("beagle-runtime")),_jsStringify=_interopRequireDefault(require("js-stringify"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function isConstant(a){return(0,_constantinople.default)(a,{pug:_beagleRuntime.default,pug_interp:void 0})}function toConstant(a){return _constantinople.default.toConstant(a,{pug:_beagleRuntime.default,pug_interp:void 0})}module.exports=compileAttrs;/**
 * options:
 *  - terse
 *  - runtime
 *  - format ('html' || 'object')
 */function compileAttrs(a,b){function c(a,c,d,e){if(!isConstant(c))"html"===b.format?e.push(b.runtime("attr")+"(\""+a+"\", "+c+", "+(0,_jsStringify.default)(d)+", "+(0,_jsStringify.default)(b.terse)+")"):(d&&(c=b.runtime("escape")+"("+c+")"),e.push((0,_jsStringify.default)(a)+": "+c));else if("html"===b.format){var f=(0,_jsStringify.default)(_beagleRuntime.default.attr(a,toConstant(c),d,b.terse)),g=e[e.length-1];g&&g[g.length-1]===f[0]?e[e.length-1]=g.substr(0,g.length-1)+f.substr(1):e.push(f)}else c=toConstant(c),d&&(c=_beagleRuntime.default.escape(c)),e.push((0,_jsStringify.default)(a)+": "+(0,_jsStringify.default)(c))}(0,_assert.default)(Array.isArray(a),"Attrs should be an array"),(0,_assert.default)(a.every(function(a){return a&&"object"==typeof a&&"string"==typeof a.name&&("string"==typeof a.val||"boolean"==typeof a.val)&&"boolean"==typeof a.mustEscape}),"All attributes should be supplied as an object of the form {name, val, mustEscape}"),(0,_assert.default)(b&&"object"==typeof b,"Options should be an object"),(0,_assert.default)("boolean"==typeof b.terse,"Options.terse should be a boolean"),(0,_assert.default)("function"==typeof b.runtime,"Options.runtime should be a function that takes a runtime function name and returns the source code that will evaluate to that function at runtime"),(0,_assert.default)("html"===b.format||"object"===b.format,"Options.format should be \"html\" or \"object\"");var d=[],e=[],f=[];a.forEach(function(a){var g=a.name,h=a.val,i=a.mustEscape;"class"===g?(e.push(h),f.push(i)):("style"===g&&(isConstant(h)?h=(0,_jsStringify.default)(_beagleRuntime.default.style(toConstant(h))):h=b.runtime("style")+"("+h+")"),c(g,h,i,d))});var g=[];return e.length&&(e.every(isConstant)?c("class",(0,_jsStringify.default)(_beagleRuntime.default.classes(e.map(toConstant),f)),!1,g):(e=e.map(function(a,b){return isConstant(a)&&(a=(0,_jsStringify.default)(f[b]?_beagleRuntime.default.escape(toConstant(a)):toConstant(a)),f[b]=!1),a}),c("class",b.runtime("classes")+"(["+e.join(",")+"], "+(0,_jsStringify.default)(f)+")",!1,g))),d=g.concat(d),"html"===b.format?d.length?d.join("+"):"\"\"":"{"+d.join(",")+"}"}