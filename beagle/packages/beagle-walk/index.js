"use strict";module.exports=walkAST;function walkAST(a,b,c,d){function e(a){return a.reduce(function(a,e){var f=walkAST(e,b,c,d);return Array.isArray(f)?a.concat(f):a.concat([f])},[])}c&&"object"==typeof c&&"undefined"==typeof d&&(d=c,c=null),d=d||{includeDependencies:!1};var f=d.parents=d.parents||[],g=function c(b){if(Array.isArray(b)&&!c.arrayAllowed)throw new Error("replace() can only be called with an array if the last parent is a Block or NamedBlock");a=b};if(g.arrayAllowed=f[0]&&(/^(Named)?Block$/.test(f[0].type)||"RawInclude"===f[0].type&&"IncludeFilter"===a.type),b){var h=b(a,g);if(!1===h)return a;if(Array.isArray(a))// return right here to skip after() call on array
return e(a)}switch(f.unshift(a),a.type){case"NamedBlock":case"Block":a.nodes=e(a.nodes);break;case"Case":case"Filter":case"Mixin":case"Tag":case"InterpolatedTag":case"When":case"Code":case"While":a.block&&(a.block=walkAST(a.block,b,c,d));break;case"Each":a.block&&(a.block=walkAST(a.block,b,c,d)),a.alternate&&(a.alternate=walkAST(a.alternate,b,c,d));break;case"EachOf":a.block&&(a.block=walkAST(a.block,b,c,d));break;case"Conditional":a.consequent&&(a.consequent=walkAST(a.consequent,b,c,d)),a.alternate&&(a.alternate=walkAST(a.alternate,b,c,d));break;case"Include":walkAST(a.block,b,c,d),walkAST(a.file,b,c,d);break;case"Extends":walkAST(a.file,b,c,d);break;case"RawInclude":a.filters=e(a.filters),walkAST(a.file,b,c,d);break;case"Attrs":case"BlockComment":case"Comment":case"Doctype":case"IncludeFilter":case"MixinBlock":case"YieldBlock":case"Text":break;case"FileReference":d.includeDependencies&&a.ast&&walkAST(a.ast,b,c,d);break;default:throw new Error("Unexpected node type "+a.type)}return f.shift(),c&&c(a,g),a}